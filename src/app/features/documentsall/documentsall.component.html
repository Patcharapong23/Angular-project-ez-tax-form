<section class="page">
  <div
    style="
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    "
  >
    <h1 class="page-title" style="margin: 0">รายการเอกสารทั้งหมด</h1>
    <button class="btn btn-primary" (click)="createNewDocument()">
      <i class="ti ti-plus"></i>
      สร้างเอกสารใหม่
    </button>
  </div>
  <div class="quick-grid">
    <div class="quick-card placeholder search-card">
      <form (ngSubmit)="search()" class="search-form">
        <div class="grid-3">
          <div class="field">
            <label>เลขที่เอกสาร</label>
            <input type="text" [(ngModel)]="f.docNo" name="docNo" />
          </div>

          <div class="field">
            <label>เลขที่ผู้เสียภาษีผู้ซื้อ</label>
            <input
              type="text"
              [(ngModel)]="f.buyerTaxId"
              name="buyerTaxId"
            />
          </div>

          <div class="field">
            <label>ประเภทเอกสาร</label>
            <select [(ngModel)]="f.docType" name="docType">
              <option value="">ทั้งหมด</option>
              <option value="T01">ใบเสร็จรับเงิน (T01)</option>
              <option value="T02">ใบแจ้งหนี้ / ใบกำกับภาษี (T02)</option>
              <option value="T03">ใบเสร็จรับเงิน / ใบกำกับภาษี (T03)</option>
              <option value="T04">ใบส่งของ / ใบกำกับภาษี (T04)</option>
              <option value="380">ใบแจ้งหนี้ (380)</option>
              <option value="388">ใบกำกับภาษี (388)</option>
              <option value="80">ใบเพิ่มหนี้ (80)</option>
              <option value="81">ใบลดหนี้ (81)</option>
            </select>
          </div>

          <div class="field">
            <label>วันที่ออกเอกสาร (เริ่มต้น–สิ้นสุด)</label>
            <div class="range">
              <input
                type="date"
                [(ngModel)]="f.issueDateFrom"
                name="issueDateFrom"
              />
              <span>—</span>
              <input
                type="date"
                [(ngModel)]="f.issueDateTo"
                name="issueDateTo"
              />
            </div>
          </div>

          <div class="field">
            <label>วันที่สร้างเอกสาร (เริ่มต้น–สิ้นสุด)</label>
            <div class="range">
              <input
                type="date"
                [(ngModel)]="f.createdFrom"
                name="createdFrom"
              />
              <span>—</span>
              <input type="date" [(ngModel)]="f.createdTo" name="createdTo" />
            </div>
          </div>

          <div class="field">
            <label>สถานะเอกสาร</label>
            <select [(ngModel)]="f.status" name="status">
              <option value="">ทั้งหมด</option>
              <option value="active">ใช้งาน</option>
              <option value="cancelled">ยกเลิก</option>
            </select>
          </div>
        </div>

        <div class="action-row">
          <div class="grow"></div>
          <button type="submit" class="btn btn-warning">ค้นหา</button>
          <button type="button" class="btn btn-outline" (click)="clear()">
            เคลียร์
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="table-card">
    <table class="doc-table">
      <thead>
        <tr>
          <th><input type="checkbox" /></th>
          <th>เลขที่เอกสาร</th>
          <th>เลขที่ผู้เสียภาษี</th>
          <th>ชื่อผู้ซื้อ</th>
          <th>รหัสสาขา</th>
          <th>ประเภทเอกสาร</th>
          <th>วันที่ออกเอกสาร</th>
          <th>วันที่สร้างเอกสาร</th>
          <th>สถานะเอกสาร</th>
          <th>การดำเนินการ</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of rows">
          <td><input type="checkbox" /></td>
          <td>{{ r.docNo }}</td>
          <td>{{ r.buyerTaxId }}</td>
          <td>{{ r.buyerName }}</td>
          <td>{{ r.branchCode }}</td>
          <td>{{ r.docTypeCode }}</td>
          <td>{{ r.issueDate | date : "dd/MM/yyyy" }}</td>
          <td>{{ r.createdAt | date : "dd/MM/yyyy" }}</td>
          <td>
            <span class="badge" [ngClass]="getStatusClass(r.status)">
              {{ getStatusText(r.status) }}
            </span>
          </td>
          <td class="actions">
            <button class="icon-btn" title="ดู" (click)="viewDocument(r.id)">
              <i class="ti ti-eye"></i>
            </button>
            <button class="icon-btn" title="แก้ไข" (click)="editDocument(r.id)">
              <i class="ti ti-edit"></i>
            </button>
            <button class="icon-btn" title="ดาวน์โหลด" (click)="downloadDocument(r.id)">
              <i class="ti ti-download"></i>
            </button>
            <button
              class="icon-btn danger"
              title="ยกเลิก"
              (click)="cancelInvoice(r.docUuid)"
            >
              <i class="ti ti-x"></i>
            </button>
          </td>
        </tr>
        <tr *ngIf="rows.length === 0">
          <td colspan="10" style="text-align: center; padding: 1rem">
            ไม่พบข้อมูลเอกสาร
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</section>
